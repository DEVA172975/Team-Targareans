<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tax Analysis - Financial Agent</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(45deg, #a8edea, #fed6e3, #d299c2, #fef9d7, #dae2f8);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%); 
            color: white; padding: 30px; border-radius: 20px; margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            transform: perspective(1000px) rotateX(5deg);
            transition: transform 0.3s ease;
        }
        .header:hover { transform: perspective(1000px) rotateX(0deg) scale(1.02); }
        .nav { 
            background: linear-gradient(145deg, #ffffff, #f0f0f0); 
            padding: 15px; border-radius: 15px; margin-bottom: 20px; 
            box-shadow: 10px 10px 20px #d1d9e6, -10px -10px 20px #ffffff;
        }
        .nav a { text-decoration: none; color: #4a5568; margin-right: 20px; font-weight: 500; }
        .nav a:hover { color: #2d3748; }
        .card { 
            background: linear-gradient(145deg, #ffffff, #f0f0f0); 
            padding: 25px; border-radius: 20px; 
            box-shadow: 20px 20px 60px #bebebe, -20px -20px 60px #ffffff;
            margin-bottom: 20px;
            transform: perspective(1000px) rotateY(5deg);
            transition: all 0.3s ease;
        }
        .card:hover { 
            transform: perspective(1000px) rotateY(0deg) translateY(-10px);
            box-shadow: 25px 25px 80px #bebebe, -25px -25px 80px #ffffff;
        }
        .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .metric-card { 
            background: linear-gradient(145deg, #f7fafc, #edf2f7); 
            padding: 20px; border-radius: 15px; text-align: center;
            box-shadow: 10px 10px 20px #d1d9e6, -10px -10px 20px #ffffff;
        }
        .metric-value { font-size: 2em; font-weight: bold; color: #2d3748; }
        .metric-label { color: #718096; margin-top: 5px; }
        .tax-breakdown { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .tax-type { 
            background: linear-gradient(145deg, #edf2f7, #e2e8f0); 
            padding: 15px; border-radius: 15px; text-align: center;
            box-shadow: 8px 8px 16px #d1d9e6, -8px -8px 16px #ffffff;
        }
        .efficient { color: #48bb78; }
        .inefficient { color: #f56565; }
        .table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .table th, .table td { padding: 12px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        .table th { background: #f7fafc; font-weight: 600; }
        .btn-clear { 
            background: linear-gradient(145deg, #f56565, #e53e3e); 
            color: white; padding: 10px 20px; border: none; border-radius: 15px; 
            cursor: pointer; font-weight: 500; margin: 10px 0;
            box-shadow: 8px 8px 16px #bebebe, -8px -8px 16px #ffffff;
            transition: all 0.3s ease;
        }
        .btn-clear:hover { 
            transform: translateY(-2px);
            box-shadow: 12px 12px 20px #bebebe, -12px -12px 20px #ffffff;
        }
        .chart-container { 
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            padding: 20px; border-radius: 15px; margin: 20px 0;
            box-shadow: 15px 15px 30px #bebebe, -15px -15px 30px #ffffff;
        }
        .info-section {
            background: linear-gradient(145deg, #faf5ff, #e9d8fd);
            padding: 20px; border-radius: 15px; margin-top: 30px;
            box-shadow: 10px 10px 20px #a0aec0, -10px -10px 20px #ffffff;
        }
        .info-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;
        }
        .info-card {
            background: linear-gradient(145deg, #ffffff, #f7fafc);
            padding: 15px; border-radius: 10px; text-align: center;
            box-shadow: 5px 5px 10px #d1d9e6, -5px -5px 10px #ffffff;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßæ Tax Analysis</h1>
            <p>Comprehensive tax optimization and compliance insights</p>
        </div>

        <div class="nav">
            <a href="/">Dashboard</a>
            <a href="/profit-analysis">Profit Analysis</a>
            <a href="/loss-analysis">Loss Analysis</a>
            <a href="/tax-analysis">Tax Analysis</a>
        </div>

        {% if analysis.get('status') == 'No data' %}
            <div class="card">
                <p style="text-align: center; color: #718096; padding: 40px;">No tax data available. Add revenue data to see analysis.</p>
            </div>
        {% else %}
            <div class="metric-grid">
                <div class="metric-card">
                    <div class="metric-value">‚Çπ{{ "{:,.2f}".format(analysis.total_tax_paid) }}</div>
                    <div class="metric-label">Total Tax Paid</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{ "{:.1f}".format(analysis.average_tax_rate) }}%</div>
                    <div class="metric-label">Average Tax Rate</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value {{ 'efficient' if analysis.tax_efficiency == 'Better' else 'inefficient' }}">{{ analysis.tax_efficiency }}</div>
                    <div class="metric-label">Tax Efficiency vs Competitors</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{ analysis.service_vs_product.service_months + analysis.service_vs_product.product_months }}</div>
                    <div class="metric-label">Total Months Analyzed</div>
                </div>
            </div>

            <div class="card">
                <h3>üìä Service vs Product Tax Breakdown</h3>
                <div class="tax-breakdown">
                    <div class="tax-type">
                        <h4>üõçÔ∏è Service Tax</h4>
                        <p style="font-size: 1.5em; font-weight: bold; color: #4299e1;">{{ analysis.service_vs_product.service_months }} months</p>
                        <p style="color: #718096;">Service-based taxation periods</p>
                    </div>
                    <div class="tax-type">
                        <h4>üì¶ Product Tax</h4>
                        <p style="font-size: 1.5em; font-weight: bold; color: #48bb78;">{{ analysis.service_vs_product.product_months }} months</p>
                        <p style="color: #718096;">Product-based taxation periods</p>
                    </div>
                </div>
            </div>

            {% if analysis.monthly_breakdown %}
                <div class="card">
                    <h3>üìÖ Monthly Tax Breakdown</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Tax Type</th>
                                <th>Tax Rate</th>
                                <th>Tax Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for month in analysis.monthly_breakdown %}
                                <tr>
                                    <td>{{ month.month }}</td>
                                    <td>
                                        {% if month.tax_type == 'service_tax' %}
                                            üõçÔ∏è Service Tax
                                        {% else %}
                                            üì¶ Product Tax
                                        {% endif %}
                                    </td>
                                    <td>{{ "{:.1f}".format(month.tax_rate) }}%</td>
                                    <td>‚Çπ{{ "{:,.2f}".format(month.tax_amount) }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}

            <div class="card">
                <h3>üí° Tax Optimization Recommendations</h3>
                
                {% if analysis.tax_efficiency == 'Better' %}
                    <p style="color: #48bb78; margin-bottom: 15px;">‚úÖ <strong>Excellent Tax Management:</strong> You're paying lower tax rates than industry competitors.</p>
                {% else %}
                    <p style="color: #f56565; margin-bottom: 15px;">‚ö†Ô∏è <strong>Tax Optimization Needed:</strong> Your tax burden is higher than industry average.</p>
                {% endif %}

                <ul style="margin: 15px 0; padding-left: 20px; color: #4a5568;">
                    {% if analysis.average_tax_rate > 25 %}
                        <li><strong>High Tax Rate Alert:</strong> Consider consulting a tax professional for optimization strategies</li>
                    {% endif %}
                    
                    {% if analysis.service_vs_product.service_months > analysis.service_vs_product.product_months %}
                        <li>Service-heavy business: Explore service tax deductions and exemptions</li>
                        <li>Consider structuring some services as products if legally permissible</li>
                    {% else %}
                        <li>Product-focused business: Leverage manufacturing and inventory tax benefits</li>
                        <li>Explore product tax credits and depreciation advantages</li>
                    {% endif %}
                    
                    <li>Maintain detailed records for all tax-deductible business expenses</li>
                    <li>Consider quarterly tax planning to optimize cash flow</li>
                    <li>Review tax structure annually as business grows and changes</li>
                </ul>
            </div>
        {% endif %}

        <div class="chart-container">
            <h3>üìà Tax Trend Analysis</h3>
            <canvas id="taxChart" width="400" height="200"></canvas>
        </div>

        <button class="btn-clear" onclick="clearTaxData()">Clear Tax Analysis Data</button>

        <div class="info-section">
            <h3>üìä Tax Rates & Compliance Information</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>Service Tax Rates</h4>
                    <p><strong>Small Business:</strong> 18%</p>
                    <p><strong>Medium Business:</strong> 28%</p>
                </div>
                <div class="info-card">
                    <h4>Product Tax Rates</h4>
                    <p><strong>Retail Small:</strong> 12%</p>
                    <p><strong>Retail Medium:</strong> 18%</p>
                </div>
                <div class="info-card">
                    <h4>Technology Sector</h4>
                    <p><strong>Services:</strong> 20%</p>
                    <p><strong>Startups:</strong> Benefits Available</p>
                </div>
                <div class="info-card">
                    <h4>Manufacturing</h4>
                    <p><strong>Products:</strong> 15%</p>
                    <p><strong>Export:</strong> 0% GST</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let taxChart;
        
        function initChart() {
            const ctx = document.getElementById('taxChart').getContext('2d');
            taxChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Tax Amount (‚Çπ)',
                        data: [],
                        borderColor: '#805ad5',
                        backgroundColor: 'rgba(128, 90, 213, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }
        
        function clearTaxData() {
            if (confirm('Are you sure you want to clear all tax analysis data?')) {
                fetch('/api/clear-tax-data', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        alert('Tax data cleared successfully!');
                        location.reload();
                    })
                    .catch(error => alert('Error clearing data'));
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
        });
    </script>
</body>
</html>