<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profit Analysis - Financial Agent</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(45deg, #c6f6d5, #9ae6b4, #68d391, #48bb78, #38a169);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); 
            color: white; padding: 30px; border-radius: 20px; margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            transform: perspective(1000px) rotateX(5deg);
            transition: transform 0.3s ease;
        }
        .header:hover { transform: perspective(1000px) rotateX(0deg) scale(1.02); }
        .nav { 
            background: linear-gradient(145deg, #ffffff, #f0f0f0); 
            padding: 15px; border-radius: 15px; margin-bottom: 20px; 
            box-shadow: 10px 10px 20px #d1d9e6, -10px -10px 20px #ffffff;
        }
        .nav a { text-decoration: none; color: #4a5568; margin-right: 20px; font-weight: 500; }
        .nav a:hover { color: #2d3748; }
        .card { 
            background: linear-gradient(145deg, #ffffff, #f0f0f0); 
            padding: 25px; border-radius: 20px; 
            box-shadow: 20px 20px 60px #bebebe, -20px -20px 60px #ffffff;
            margin-bottom: 20px;
            transform: perspective(1000px) rotateY(5deg);
            transition: all 0.3s ease;
        }
        .card:hover { 
            transform: perspective(1000px) rotateY(0deg) translateY(-10px);
            box-shadow: 25px 25px 80px #bebebe, -25px -25px 80px #ffffff;
        }
        .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .metric-card { 
            background: linear-gradient(145deg, #f7fafc, #edf2f7); 
            padding: 20px; border-radius: 15px; text-align: center;
            box-shadow: 10px 10px 20px #d1d9e6, -10px -10px 20px #ffffff;
        }
        .metric-value { font-size: 2em; font-weight: bold; color: #2d3748; }
        .metric-label { color: #718096; margin-top: 5px; }
        .positive { color: #48bb78; }
        .negative { color: #f56565; }
        .btn-clear { 
            background: linear-gradient(145deg, #f56565, #e53e3e); 
            color: white; padding: 10px 20px; border: none; border-radius: 15px; 
            cursor: pointer; font-weight: 500; margin: 10px 0;
            box-shadow: 8px 8px 16px #bebebe, -8px -8px 16px #ffffff;
            transition: all 0.3s ease;
        }
        .btn-clear:hover { 
            transform: translateY(-2px);
            box-shadow: 12px 12px 20px #bebebe, -12px -12px 20px #ffffff;
        }
        .chart-container { 
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            padding: 20px; border-radius: 15px; margin: 20px 0;
            box-shadow: 15px 15px 30px #bebebe, -15px -15px 30px #ffffff;
        }
        .info-section {
            background: linear-gradient(145deg, #f0fff4, #c6f6d5);
            padding: 20px; border-radius: 15px; margin-top: 30px;
            box-shadow: 10px 10px 20px #a0aec0, -10px -10px 20px #ffffff;
        }
        .info-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;
        }
        .info-card {
            background: linear-gradient(145deg, #ffffff, #f7fafc);
            padding: 15px; border-radius: 10px; text-align: center;
            box-shadow: 5px 5px 10px #d1d9e6, -5px -5px 10px #ffffff;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìà Profit Analysis</h1>
            <p>Comprehensive profit performance and competitive positioning</p>
        </div>

        <div class="nav">
            <a href="/">Dashboard</a>
            <a href="/profit-analysis">Profit Analysis</a>
            <a href="/loss-analysis">Loss Analysis</a>
            <a href="/tax-analysis">Tax Analysis</a>
        </div>

        {% if analysis.get('status') == 'No data' %}
            <div class="card">
                <p style="text-align: center; color: #718096; padding: 40px;">No profit data available. Add revenue data to see analysis.</p>
            </div>
        {% else %}
            <div class="metric-grid">
                <div class="metric-card">
                    <div class="metric-value positive">‚Çπ{{ "{:,.2f}".format(analysis.current_profit) }}</div>
                    <div class="metric-label">Current Month Profit</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">‚Çπ{{ "{:,.2f}".format(analysis.average_profit) }}</div>
                    <div class="metric-label">Average Monthly Profit</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value {{ 'positive' if analysis.profit_trend > 0 else 'negative' }}">{{ "{:+.1f}".format(analysis.profit_trend) }}%</div>
                    <div class="metric-label">Profit Trend</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{ "{:.1f}".format(analysis.profit_margin) }}%</div>
                    <div class="metric-label">Current Profit Margin</div>
                </div>
            </div>

            <div class="card">
                <h3>üèÜ Competitive Position</h3>
                <p style="font-size: 1.2em; margin: 15px 0; color: #2d3748;">{{ analysis.competitive_position }}</p>
                <p style="color: #718096;">Based on {{ analysis.months_data }} months of data compared to industry benchmarks.</p>
            </div>

            <div class="card">
                <h3>üí° Profit Insights</h3>
                {% if analysis.profit_trend > 10 %}
                    <p>üöÄ <strong>Excellent Growth:</strong> Your profit is trending strongly upward. Consider scaling operations or expanding market reach.</p>
                {% elif analysis.profit_trend > 0 %}
                    <p>üìà <strong>Positive Trend:</strong> Steady profit growth detected. Look for opportunities to accelerate this trend.</p>
                {% else %}
                    <p>‚ö†Ô∏è <strong>Declining Profits:</strong> Profit trend is concerning. Review cost structure and revenue strategies immediately.</p>
                {% endif %}
                
                {% if analysis.profit_margin > 20 %}
                    <p style="margin-top: 10px;">‚úÖ <strong>Healthy Margins:</strong> Your profit margin of {{ "{:.1f}".format(analysis.profit_margin) }}% is excellent.</p>
                {% elif analysis.profit_margin > 10 %}
                    <p style="margin-top: 10px;">üëç <strong>Good Margins:</strong> Profit margin is solid but has room for improvement.</p>
                {% else %}
                    <p style="margin-top: 10px;">üî¥ <strong>Low Margins:</strong> Profit margin needs immediate attention to ensure sustainability.</p>
                {% endif %}
            </div>
        {% endif %}

        <div class="chart-container">
            <h3>üìà Profit Trend Chart</h3>
            <canvas id="profitChart" width="400" height="200"></canvas>
        </div>

        <button class="btn-clear" onclick="clearProfitData()">Clear Profit Analysis Data</button>

        <div class="info-section">
            <h3>üìä Profit Margins & Benchmarks</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>Retail Sector</h4>
                    <p><strong>Avg Margin:</strong> 12%</p>
                    <p><strong>Good:</strong> >15%</p>
                </div>
                <div class="info-card">
                    <h4>Services Sector</h4>
                    <p><strong>Avg Margin:</strong> 25%</p>
                    <p><strong>Good:</strong> >30%</p>
                </div>
                <div class="info-card">
                    <h4>Technology</h4>
                    <p><strong>Avg Margin:</strong> 35%</p>
                    <p><strong>Good:</strong> >40%</p>
                </div>
                <div class="info-card">
                    <h4>Manufacturing</h4>
                    <p><strong>Avg Margin:</strong> 18%</p>
                    <p><strong>Good:</strong> >22%</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let profitChart;
        
        function initChart() {
            const ctx = document.getElementById('profitChart').getContext('2d');
            profitChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Profit (‚Çπ)',
                        data: [],
                        borderColor: '#48bb78',
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }
        
        function clearProfitData() {
            if (confirm('Are you sure you want to clear profit analysis data?')) {
                fetch('/api/clear-profit-data', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        alert('Profit data cleared successfully!');
                        location.reload();
                    })
                    .catch(error => alert('Error clearing data'));
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
        });
    </script>
</body>
</html>